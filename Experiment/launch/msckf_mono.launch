<?xml version="1.0"?>
<launch>
	<arg name="rviz" default="false"/>
  <arg name="onboard" default="true"/>

  <group ns="msckf_mono">	
    <rosparam command="load" file="$(find drone_experiment)/realsense_stereo_imu_kalibr.yaml"/>
    <param name="kalibr_camera_name" value="cam0"/>

    <param name="feature_cov" value="2"/>

    <param name="imu_vars/w_var" value="1e-4"/>
    <param name="imu_vars/dbg_var" value="3.6733e-5"/>
    <param name="imu_vars/a_var" value="1e-2"/>
    <param name="imu_vars/dba_var" value="7e-2"/>

    <param name="imu_covars/p_init" value="1e-12"/>
    <param name="imu_covars/q_init" value="1e-5"/>
    <param name="imu_covars/v_init" value="1e-2"/>
    <param name="imu_covars/ba_init" value="1e-2"/>
    <param name="imu_covars/bg_init" value="1e-2"/>

    <param name="max_gn_cost_norm" value="7"/>
    <param name="translation_threshold" value="0.1"/>

    <param name="keyframe_transl_dist" value="0.5"/>
    <param name="keyframe_rot_dist" value="0.5"/>

    <param name="min_track_length" value="5"/>
    <param name="max_track_length" value="50"/>
    <param name="max_cam_states" value="30"/>

    <param name="ransac_threshold" value="0.00000002"/>

    <param name="n_grid_rows" value="10"/>
    <param name="n_grid_cols" value="10"/>

    <!-- republish topic from compressed image -->
    <node unless="$(arg onboard)" name="republish_infra1" type="republish" pkg="image_transport" args="compressed in:=/camera/infra1/image_rect_raw raw out:=/infra1" />
    <node unless="$(arg onboard)" name="republish_infra2" type="republish" pkg="image_transport" args="compressed in:=/camera/infra2/image_rect_raw raw out:=/infra2" />
      
    <node unless="$(arg onboard)" pkg="msckf_mono" name="msckf_mono_node" type="msckf_mono_node">
      <remap from="imu" to="/camera/imu"/>
      <remap from="image_mono" to="/infra1"/>
    </node>  

    <node if="$(arg onboard)" pkg="msckf_mono" name="msckf_mono_node" type="msckf_mono_node">
      <remap from="imu" to="/camera/imu"/>
      <remap from="image_mono" to="/camera/infra1/image_rect_raw"/>
    </node>
  </group>

  <node if="$(arg rviz)" pkg="rviz" name="msckf_rviz" type="rviz" args="-d $(find msckf_mono)/euroc/rviz.rviz"/>

</launch>
